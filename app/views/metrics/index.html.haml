= javascript_include_tag "https://www.gstatic.com/charts/loader.js"

.container.m-0.p-0.w-100
    .row.mb-3#sessions
        .col-3
            .row.sticky-top{:style => "top:1.0rem"}
                .col
                    .row.mb-3
                        .col
                            .card.shadow-sm.sticky-top
                                .card-header
                                    %h5 Sessions
                                .card-body
                                    %table.table
                                        %tr
                                            %th Country
                                            %th Visits
                                        %tbody
                                            - @Locations.sort_by { |k,v| v }[0..1].to_h.keys.each do |key|
                                                %tr 
                                                    %td= key
                                                    %td= @Locations[key]
                    .row
                        .col
                            .card.shadow-sm.sticky-top
                                .card-header
                                    %h5 Registrations
                                .card-body
                                    %table.table
                                        %tr
                                            %th Country
                                            %th Visits
                                        %tbody
                                            - @Registrations.sort_by { |k,v| v }[0..1].to_h.keys.each do |key|
                                                %tr 
                                                    %td= key
                                                    %td= @Registrations[key]
        .col-9
            .row.mb-3{:style=>"scroll-snap-align: start;"}
                .col
                    .card.shadow-sm.sticky-top
                        .card-header
                            %h5 Session Location
                        .card-body.w-100.ratio.ratio-16x9
                            = geo_chart @Locations, height: "100%", width: "100%", colors: ["#3467eb", "#3467eb"]

            .row.mb-3{:style=>"scroll-snap-align: center;"}
                .col
                    .card.shadow-sm.sticky-top
                        .card-header
                            %h5 Registration Location
                        .card-body.w-100.ratio.ratio-16x9
                            = geo_chart @Registrations, id: "test", height: "100%", width: "100%"
    .row.mb-3
        .col-12
            .card.shadow-sm.sticky-top
                .card-header
                    %h5 Sessions
                .card-body
                    = line_chart @Metrics.keys.map{|key| {name: key, data: @Metrics[key].group_by_day(:created_at).count}}
    .row.mb-3
        .col-3
            .card.shadow-sm.sticky-top
                .card-header
                    %h5 Pricing Options
                .card-body
                    %table.table
                        %tr
                            %th Tier
                            %th Clicks
                        %tbody
                            - @Clicks.keys.each do |key|
                                %tr 
                                    %td= key
                                    %td= @Clicks[key]
        .col-9
            .card.shadow-sm.sticky-top
                .card-header
                    %h5 Pricing Options
                .card-body
                    = line_chart @Clicks_2.keys.map{|key| {name: key, data: @Clicks_2[key].group_by_day(:created_at).count}}

    .row.mb-3
        .col-3
            .card.shadow-sm.sticky-top
                .card-header
                    %h5 Feature Shares
                .card-body
                    %table.table
                        %tr
                            %th Feature
                            %th By Email
                        %tbody
                            - @Clicks.keys.each do |key|
                                %tr 
                                    %td= key
                                    %td= @Clicks[key]
        .col-9
            .card.shadow-sm
                .card-header
                    %h5 Feature Shares
                .card-body
                    = line_chart @Clicks_2.keys.map{|key| {name: key, data: @Clicks_2[key].group_by_day(:created_at).count}}

